name: Test Connection

on:
    workflow_dispatch:

jobs:
    test:
        runs-on: ubuntu-latest
        steps:
            - name: Test server
              uses: appleboy/ssh-action@v0.1.7
              with:
                  host: ${{ secrets.SERVER_HOST }}
                  username: ${{ secrets.SERVER_USER }}
                  key: ${{ secrets.SERVER_SSH_KEY }}
                  script: |
                      echo "Testing connection..."
                      whoami
                      docker --version

                      cd /home/${{ secrets.SERVER_USER }}/ReflectaBot
                      ls -la

                      echo "Testing bot endpoint..."
                      curl -X POST -H "Content-Type: application/json" \
                        -d '{"message":{"chat":{"id":123},"text":"test","from":{"first_name":"Test"}}}' \
                        http://localhost:5211/api/update

                      echo "Test complete"
